<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üö® Nurse Dashboard - Belle Vue</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&family=Poppins:wght@300;600&display=swap');

:root {
    --primary-red: #E31E24;
    --neon-green: #1B9D4A;
    --bg-black: #080808;
}

body {
    margin: 0; padding: 0;
    background-color: var(--bg-black);
    color: white;
    font-family: 'Poppins', sans-serif;
    text-align: center;
}

/* Activation Overlay */
#activation-screen {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.98);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.start-btn {
    padding: 15px 40px;
    font-size: 20px;
    background: var(--primary-red);
    color: white;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    font-family: 'Orbitron', sans-serif;
    box-shadow: 0 0 20px var(--primary-red);
}

/* Header */
header { padding: 20px 10px; }
.belle-vue {
    font-family: 'Orbitron', sans-serif;
    font-weight: 900;
    font-size: 50px;
    color: var(--neon-green);
    margin: 0;
}
.hospital-tag {
    font-size: 25px;
    color: var(--primary-red);
    font-weight: bold;
    margin-top: -10px;
    display: block;
}

/* Summary Box */
#summary-bar {
    display: none;
    margin: 10px auto;
    background: rgba(227, 30, 36, 0.1);
    border: 1px solid var(--primary-red);
    padding: 10px 25px;
    border-radius: 50px;
    width: fit-content;
}

.count-text {
    font-family: 'Orbitron', sans-serif;
    font-size: 30px;
    color: var(--primary-red);
}

/* Compact Room Container */
#call-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

/* ‡¶∞‡ßÅ‡¶Æ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶õ‡ßã‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá */
.room-chip {
    background: linear-gradient(145deg, #222, #000);
    border: 1.5px solid var(--primary-red);
    padding: 8px 15px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 100px;
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes popIn {
    from { transform: scale(0.5); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.room-num {
    font-family: 'Orbitron', sans-serif;
    font-size: 18px;
    font-weight: bold;
    color: white;
}

.clear-x {
    color: var(--primary-red);
    cursor: pointer;
    font-weight: bold;
    font-size: 18px;
    padding: 0 5px;
}

.clear-x:hover { color: white; }

/* Siren Flash */
#flash-bg {
    display: none;
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    pointer-events: none;
    z-index: 998;
    animation: flash 0.5s infinite alternate;
}
@keyframes flash { from { background: rgba(227,30,36,0); } to { background: rgba(227,30,36,0.1); } }

.empty-msg { opacity: 0.3; margin-top: 50px; }

.reset-btn {
    margin-top: 40px;
    background: #444;
    color: #ccc;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px;
}
</style>
</head>
<body>

<div id="activation-screen">
    <h1 style="color:var(--neon-green); font-family:'Orbitron'">BELLE VUE</h1>
    <button class="start-btn" onclick="startSystem()">ACTIVATE DASHBOARD</button>
</div>

<div id="flash-bg"></div>

<header>
    <span class="belle-vue">BELLE VUE</span>
    <span class="hospital-tag">Hospital</span>
    <div style="font-size:12px; color:#666; letter-spacing:3px; margin-top:10px;">NURSING CALL LIVE FEED</div>
</header>

<div id="summary-bar">
    <span style="font-size:20px">üö®</span> 
    <span class="count-text" id="total-calls">0</span> 
    <span style="font-size:12px; text-transform:uppercase; margin-left:10px">Active Calls</span>
</div>

<div id="call-container">
    <div class="empty-msg">WAITING FOR CALLS...</div>
</div>

<button class="reset-btn" onclick="resetAll()">SYSTEM RESET</button>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
let aCtx = null;
let isSirenOn = false;

const firebaseConfig = { databaseURL: "https://unlimited-nursing-calling-blv-default-rtdb.firebaseio.com/" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function startSystem() {
    aCtx = new (window.AudioContext || window.webkitAudioContext)();
    document.getElementById('activation-screen').style.display = 'none';
}

function triggerSiren() {
    if (isSirenOn || !aCtx) return;
    isSirenOn = true;
    document.getElementById('flash-bg').style.display = 'block';
    
    const play = () => {
        if (!isSirenOn) return;
        let n = aCtx.currentTime;
        let o = aCtx.createOscillator();
        let g = aCtx.createGain();
        o.type = 'sawtooth';
        o.frequency.setValueAtTime(700, n);
        o.frequency.exponentialRampToValueAtTime(1000, n + 0.6);
        o.frequency.exponentialRampToValueAtTime(700, n + 1.2);
        g.gain.setValueAtTime(0, n);
        g.gain.linearRampToValueAtTime(0.3, n + 0.1);
        g.gain.linearRampToValueAtTime(0, n + 1.2);
        o.connect(g); g.connect(aCtx.destination);
        o.start(n); o.stop(n + 1.2);
        setTimeout(play, 1300);
    };
    play();
}

db.ref('calls').on('value', snap => {
    const data = snap.val();
    const container = document.getElementById('call-container');
    const bar = document.getElementById('summary-bar');
    const countEl = document.getElementById('total-calls');
    
    container.innerHTML = "";
    let count = 0;

    if (data) {
        Object.keys(data).forEach(room => {
            if (data[room] === true) {
                count++;
                const chip = document.createElement('div');
                chip.className = 'room-chip';
                chip.innerHTML = `<span class="room-num">${room}</span><span class="clear-x" onclick="clearRoom('${room}')">‚úï</span>`;
                container.appendChild(chip);
            }
        });
    }

    if (count > 0) {
        countEl.textContent = count;
        bar.style.display = 'block';
        triggerSiren();
    } else {
        bar.style.display = 'none';
        isSirenOn = false;
        document.getElementById('flash-bg').style.display = 'none';
        container.innerHTML = '<div class="empty-msg">‚úÖ ALL ROOMS CLEAR</div>';
    }
});

function clearRoom(r) { db.ref('calls/' + r).remove(); }
function resetAll() { if(confirm("Reset all?")) db.ref('calls').remove(); }
</script>
</body>
</html>
