<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üö® Nurse Dashboard - Belle Vue</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Poppins:wght@600&display=swap');

:root {
    --primary-red: #ff1f26;
    --neon-green: #1B9D4A;
    --bg-black: #050505;
}

body {
    margin: 0; padding: 0;
    background-color: var(--bg-black);
    color: white;
    font-family: 'Poppins', sans-serif;
}

/* Activation Screen */
#activation-screen {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: var(--bg-black);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.start-btn {
    padding: 20px 60px;
    font-size: 24px;
    background: var(--primary-red);
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-family: 'Orbitron', sans-serif;
    box-shadow: 0 0 30px rgba(255, 31, 38, 0.5);
}

/* Header */
header { padding: 30px 10px; text-align: center; }
.belle-vue {
    font-family: 'Orbitron', sans-serif;
    font-weight: 900;
    font-size: clamp(40px, 8vw, 65px);
    color: var(--neon-green);
    margin: 0;
}
.hospital-tag {
    font-size: clamp(20px, 4vw, 30px);
    color: var(--primary-red);
    font-weight: bold;
    display: block;
    margin-top: -10px;
}

/* Summary Bar */
#summary-bar {
    display: none;
    margin: 20px auto;
    background: rgba(255, 31, 38, 0.15);
    border: 2px solid var(--primary-red);
    padding: 15px 40px;
    border-radius: 15px;
    width: fit-content;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); box-shadow: 0 0 10px rgba(255, 31, 38, 0.2); }
    50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(255, 31, 38, 0.5); }
    100% { transform: scale(1); box-shadow: 0 0 10px rgba(255, 31, 38, 0.2); }
}

.count-text {
    font-family: 'Orbitron', sans-serif;
    font-size: 45px;
    color: white;
}

/* Room Box - ‡¶¨‡ßú ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ */
#call-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    padding: 30px;
}

.room-box {
    background: linear-gradient(145deg, #cc1a1f, #800000);
    border: 4px solid #fff;
    padding: 25px 40px;
    border-radius: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-width: 160px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes pop {
    from { transform: scale(0); }
    to { transform: scale(1); }
}

/* ‡¶∞‡ßÅ‡¶Æ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶´‡¶®‡ßç‡¶ü ‡¶¨‡ßú ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá */
.room-num {
    font-family: 'Orbitron', sans-serif;
    font-size: 65px; /* ‡¶Ö‡¶®‡ßá‡¶ï ‡¶¨‡ßú ‡¶∏‡¶æ‡¶á‡¶ú */
    font-weight: 900;
    color: white;
    line-height: 1;
    margin-bottom: 10px;
}

.clear-btn {
    background: white;
    color: #800000;
    border: none;
    padding: 8px 25px;
    border-radius: 30px;
    font-weight: bold;
    cursor: pointer;
    font-size: 16px;
    text-transform: uppercase;
}

.clear-btn:hover { background: #000; color: #fff; }

/* Siren Background */
#flash-bg {
    display: none;
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    pointer-events: none;
    z-index: 998;
    animation: flash 0.6s infinite alternate;
}
@keyframes flash { 
    from { background: rgba(0,0,255,0.08); } 
    to { background: rgba(255,0,0,0.12); } 
}

.empty-msg { opacity: 0.2; font-size: 24px; margin-top: 100px; }
</style>
</head>
<body>

<div id="activation-screen">
    <h1 style="color:var(--neon-green); font-family:'Orbitron'; font-size: 50px;">BELLE VUE</h1>
    <button class="start-btn" onclick="initDashboard()">START STATION</button>
</div>

<div id="flash-bg"></div>

<header>
    <span class="belle-vue">BELLE VUE</span>
    <span class="hospital-tag">Hospital</span>
</header>

<div id="summary-bar">
    <span class="count-text" id="total-calls">0</span> 
    <span style="font-size:18px; text-transform:uppercase; margin-left:15px; letter-spacing: 2px;">Active Calls</span>
</div>

<div id="call-container">
    <div class="empty-msg">SYSTEM READY...</div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
let audio = null;
let isAlerting = false;

const firebaseConfig = { databaseURL: "https://unlimited-nursing-calling-blv-default-rtdb.firebaseio.com/" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function initDashboard() {
    audio = new (window.AudioContext || window.webkitAudioContext)();
    document.getElementById('activation-screen').style.display = 'none';
}

function startSiren() {
    if (isAlerting || !audio) return;
    isAlerting = true;
    document.getElementById('flash-bg').style.display = 'block';
    
    const alarm = () => {
        if (!isAlerting) return;
        let t = audio.currentTime;
        let o = audio.createOscillator();
        let g = audio.createGain();
        o.type = 'sawtooth';
        o.frequency.setValueAtTime(600, t);
        o.frequency.exponentialRampToValueAtTime(1200, t + 0.6);
        o.frequency.exponentialRampToValueAtTime(600, t + 1.2);
        g.gain.setValueAtTime(0, t);
        g.gain.linearRampToValueAtTime(0.4, t + 0.1);
        g.gain.linearRampToValueAtTime(0, t + 1.2);
        o.connect(g); g.connect(audio.destination);
        o.start(t); o.stop(t + 1.2);
        setTimeout(alarm, 1300);
    };
    alarm();
}

db.ref('calls').on('value', snap => {
    const data = snap.val();
    const container = document.getElementById('call-container');
    const bar = document.getElementById('summary-bar');
    const countLabel = document.getElementById('total-calls');
    
    container.innerHTML = "";
    let activeRooms = 0;

    if (data) {
        Object.keys(data).forEach(room => {
            if (data[room] === true) {
                activeRooms++;
                const box = document.createElement('div');
                box.className = 'room-box';
                box.innerHTML = `<span class="room-num">${room}</span>
                                <button class="clear-btn" onclick="clearRoom('${room}')">Done</button>`;
                container.appendChild(box);
            }
        });
    }

    if (activeRooms > 0) {
        countLabel.textContent = activeRooms;
        bar.style.display = 'block';
        startSiren();
    } else {
        bar.style.display = 'none';
        isAlerting = false;
        document.getElementById('flash-bg').style.display = 'none';
        container.innerHTML = '<div class="empty-msg">‚úÖ ALL ROOMS CLEAR</div>';
    }
});

function clearRoom(r) { db.ref('calls/' + r).remove(); }
</script>
</body>
</html>
